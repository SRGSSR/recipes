
<script>
    WFP_settings = ${wfpSettings};
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://tumult.wfp.monotype.com/v1/embed.min.js" id="wfp"></script>

<script>

var gPollCount = 0;
var kPollInterval = 100;
var kPollMaxTimeout = 10000;

function wfpLoadPoll() {
	if(window.WFP == null) {
		if((gPollCount * kPollInterval) < kPollMaxTimeout) {
			window.setTimeout(wfpLoadPoll, kPollInterval);
		}
		gPollCount += 1;
	} else {
		WFP.on("published", wfpFontPublished, this);
		WFP.on("publish-errors", wfpFontPublishErrors, this);
	
		window.setTimeout(function () {
			WFP.publish(${fontsInUse});
		}, 1000);
	}
}

function wfpFontPublished(data) {
	console.log("published");
	console.log(data);
	window.monotypePublishController.fontPublishSucceeded_(JSON.stringify(data));
}

function wfpFontPublishErrors(data) {
	console.log("publish errors");
	console.log(data);

	window.monotypePublishController.fontPublishFailed_(JSON.stringify(data));
}

window.onload = (function () { wfpLoadPoll(); });

</script>
