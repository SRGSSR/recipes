
<script>
    WFP_settings = ${wfpSettings};
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://tumult.wfp.monotype.com/v1/embed.min.js" id="wfp"></script>

<script>

var gPollCount = 0;
var kPollInterval = 100;
var kPollMaxTimeout = 10000;

function wfpLoadPoll() {
	if(window.WFP == null) {
		if((gPollCount * kPollInterval) < kPollMaxTimeout) {
			window.setTimeout(wfpLoadPoll, kPollInterval);
		}
		gPollCount += 1;
	} else {
		window.WFP.getFonts(function (fonts) {
			if(fonts == null) {
				// some sort of error
				return;
			}
			
			var fontsJSON = [];
			for(var i = 0; i < fonts.length; i++) {
				var font = fonts[i];
				var fontJSON = {};
				fontJSON["family"] = font["name"];
				fontJSON["id"] = font["id"];
				fontJSON["variants"] = [];
				
				for(var j = 0; j < font["variations"].length; j++) {
					var variation = font["variations"][j];
					var variationJSON = {};
					
					variationJSON["css_url"] = variation["css"]["url"];
					variationJSON["css_font_family"] = variation["css"]["font_family"];
					variationJSON["name"] = variation["name"];
					variationJSON["id"] = variation["id"];
					
					fontJSON["variants"].push(variationJSON);
				}
			
				fontsJSON.push(fontJSON);
			}
		
			window.monotypeFontsSourceController.finishedLoadingMonotypeFonts_(JSON.stringify(fontsJSON));
		
		});
	}
}

window.onload = (function () { wfpLoadPoll(); });

</script>
